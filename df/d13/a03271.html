<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JKQTPlotter: JKQTPHighResTimer Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../jkqtplotter_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">JKQTPlotter
   </div>
   <div id="projectbrief">an extensive Qt4/Qt5 Plotter framework (including a fast variant and a LaTeX equation renderer!), written fully in C/C++ and without external dependencies</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="../../annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="../../classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="../../inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="../../functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('df/d13/a03271.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="../../d4/dcb/a03268.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">JKQTPHighResTimer Class Reference<div class="ingroups"><a class="el" href="../../de/d9d/a02072.html">Tool Functions and Definitions for JKQTPlotter</a> &raquo; <a class="el" href="../../dc/d21/a02079.html">Debugging Tools</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>This class implements a high resolution timer capable of measuring time intervals with a resolution of some microseconds.  
 <a href="../../df/d13/a03271.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="../../d7/d38/a02054_source.html">jkqtphighrestimer.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aa0b4bd1be0d7c11e2b286670508edaa1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d13/a03271.html#aa0b4bd1be0d7c11e2b286670508edaa1">JKQTPHighResTimer</a> ()</td></tr>
<tr class="memdesc:aa0b4bd1be0d7c11e2b286670508edaa1"><td class="mdescLeft">&#160;</td><td class="mdescRight">class constructor.  <a href="#aa0b4bd1be0d7c11e2b286670508edaa1">More...</a><br /></td></tr>
<tr class="separator:aa0b4bd1be0d7c11e2b286670508edaa1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1648000a7686774bc6b6b029fdd4428"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d13/a03271.html#ac1648000a7686774bc6b6b029fdd4428">~JKQTPHighResTimer</a> ()</td></tr>
<tr class="memdesc:ac1648000a7686774bc6b6b029fdd4428"><td class="mdescLeft">&#160;</td><td class="mdescRight">class destructor  <a href="#ac1648000a7686774bc6b6b029fdd4428">More...</a><br /></td></tr>
<tr class="separator:ac1648000a7686774bc6b6b029fdd4428"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a667f5e7198a11aa861a5d51e8637408e"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d13/a03271.html#a667f5e7198a11aa861a5d51e8637408e">getTime</a> ()</td></tr>
<tr class="memdesc:a667f5e7198a11aa861a5d51e8637408e"><td class="mdescLeft">&#160;</td><td class="mdescRight">get the time since the last call of <a class="el" href="../../df/d13/a03271.html#a75a2f3ac301bde7a14fa9b39471354ba" title="start the timer">start()</a> in microseconds  <a href="#a667f5e7198a11aa861a5d51e8637408e">More...</a><br /></td></tr>
<tr class="separator:a667f5e7198a11aa861a5d51e8637408e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75a2f3ac301bde7a14fa9b39471354ba"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d13/a03271.html#a75a2f3ac301bde7a14fa9b39471354ba">start</a> ()</td></tr>
<tr class="memdesc:a75a2f3ac301bde7a14fa9b39471354ba"><td class="mdescLeft">&#160;</td><td class="mdescRight">start the timer  <a href="#a75a2f3ac301bde7a14fa9b39471354ba">More...</a><br /></td></tr>
<tr class="separator:a75a2f3ac301bde7a14fa9b39471354ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26a9b2f4fb964fd9e86d51f218a94de0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d13/a03271.html#a26a9b2f4fb964fd9e86d51f218a94de0">test</a> (double *mean, double *stddev, unsigned long *histogram=nullptr, double *histogram_x=nullptr, unsigned long histogram_size=0)</td></tr>
<tr class="memdesc:a26a9b2f4fb964fd9e86d51f218a94de0"><td class="mdescLeft">&#160;</td><td class="mdescRight">test the resolution  <a href="#a26a9b2f4fb964fd9e86d51f218a94de0">More...</a><br /></td></tr>
<tr class="separator:a26a9b2f4fb964fd9e86d51f218a94de0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:abd10df27113d10087fec1b46ef031e81"><td class="memItemLeft" align="right" valign="top">struct timeval&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d13/a03271.html#abd10df27113d10087fec1b46ef031e81">last</a></td></tr>
<tr class="separator:abd10df27113d10087fec1b46ef031e81"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This class implements a high resolution timer capable of measuring time intervals with a resolution of some microseconds. </p>
<dl class="section attention"><dt>Attention</dt><dd>Note that this is a MS Windows specific implementation od a high-resolution timer using some of windows' API methods (namely <code>QueryPerformanceCounter()</code> and <code>QueryPerformanceFrequency()</code> ). So if you want to use this class on non-win32 systems you will have to find a way to implement it for your system!!!</dd>
<dd>
Also note that a standard windows system is NOT a real time OS. So do not expect to get a high accuracy when timing operations using this timer. It gives you an accurate time stamp, but it can not guarantee when the code is executed!</dd></dl>
<p>The timer works very simple:</p><ul>
<li>you can start the timer with <a class="el" href="../../df/d13/a03271.html#a75a2f3ac301bde7a14fa9b39471354ba" title="start the timer">start()</a> which means you set a time=0</li>
<li>then you can query the time difference to the last call of <a class="el" href="../../df/d13/a03271.html#a75a2f3ac301bde7a14fa9b39471354ba" title="start the timer">start()</a> by using <a class="el" href="../../df/d13/a03271.html#a667f5e7198a11aa861a5d51e8637408e" title="get the time since the last call of start() in microseconds">getTime()</a>.</li>
</ul>
<p>There is also a test method <a class="el" href="../../df/d13/a03271.html#a26a9b2f4fb964fd9e86d51f218a94de0" title="test the resolution">test()</a> which will try to give you a feel for the performance of the timer in a simple application on your computer. It simply does some thousand iterations and records the time needed for each single iteration. Then it may calculate a histogram, a mean value and a standard deviation from these times.</p>
<p>This is the result of <a class="el" href="../../df/d13/a03271.html#a26a9b2f4fb964fd9e86d51f218a94de0" title="test the resolution">test()</a> on a WinXP system, Athlon64 X2 3800+ (2GHz): </p><div class="image">
<img src="../../highrestimer.png" alt="highrestimer.png"/>
</div>
<p> Note that this histogram tells you more about how your system works than about the timer itself. What we can find out about the timer is that it really provides a resolution in the microsecond region. This can be seen, as there is a non-zero minimal measured interval (1.67619 usec). This basically tells us the run-time of the measurement loop. There are also bigger run-times which are produced, as this program ran on a multi-process (not process<b>or</b> !!!) OS, which means that the current process may be stalled to allow othe rprocesses to execute. If this would run on a single-process system we should only get one run-time, if we assume that all methods need a fixed amount of time. So we can use this method to test whether our system provides a sufficiently accurate time. The 1.68 usec give an upper bound for the timer interval and thus the resolution they do <b>not</b> represent the timer resolution. To get this nominal resolution in a windows system you could use the WinAPI method <code>QueryPerformanceFrequency()</code> which is used in the method <a class="el" href="../../df/d13/a03271.html#a667f5e7198a11aa861a5d51e8637408e" title="get the time since the last call of start() in microseconds">getTime()</a>. On my system the timer frequency is 3.57955 MHz which corresponds to a resolution of 0.2794 usec.</p>
<dl class="section user"><dt>win32 implementation issues:</dt><dd>To implement this timer on windows systems I use two API calls from the windows kernel. They are:<ul>
<li><a href="http://msdn2.microsoft.com/en-us/library/ms644904.aspx">QueryPerformanceCounter()</a></li>
<li><a href="http://msdn2.microsoft.com/en-us/library/ms644905.aspx">QueryPerformanceFrequency()</a></li>
</ul>
</dd></dl>
<p><br />
The first one is used to read times: In the <a class="el" href="../../df/d13/a03271.html#a75a2f3ac301bde7a14fa9b39471354ba" title="start the timer">start()</a> method we simply save the current counter value to a variable. In <a class="el" href="../../df/d13/a03271.html#a667f5e7198a11aa861a5d51e8637408e" title="get the time since the last call of start() in microseconds">getTime()</a> we can then again use QueryPerformanceCounter() to get the current counter value and then calculate the difference between these two. Using QueryPerformanceFrequency() we can calculate the time difference in usecs from the counter value difference using: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Delta t=\frac{N_{\mbox{now}}-N_{\mbox{start}}}{\mbox{\texttt{QueryPerformanceFrequency()}}}\cdot 10^{6} \]" src="../../form_56.png"/>
</p>
<dl class="section user"><dt>why not standard POSIX?</dt><dd>The standard POSIX time functions available in a MinGW environment have a resolution that is in the range of some 10 milliseconds. This may be enough for many purposes, but for exact time measurement, as you will want to do it on measurement and control systems this is not sufficient. So I tried to find a possibility to implement a system-independent high-resolution timer. As most timer stuff depends on very low-level kernel calls on every operating system this seems to be nearly impossible. So I implemented this timer for win32 only, as this is the system we use in the lab.</dd></dl>
<dl class="section user"><dt>linux implementation possibility:</dt><dd>This class does not implement a timer for Linux/Unix systems but I will provide you with a small hint how you could implement one here: The <a href="http://www.gnu.org/software/libc/manual/html_node/High_002dResolution-Calendar.html"><code>gettimeofday()</code> method</a> from the libc seems to have enough tim resolution for our pourposes, so try to use this for the high- resolution timer. As mentioned above this method is not available for MinGW in win32 which is the main development platform for this project.</dd></dl>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="aa0b4bd1be0d7c11e2b286670508edaa1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0b4bd1be0d7c11e2b286670508edaa1">&#9670;&nbsp;</a></span>JKQTPHighResTimer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">JKQTPHighResTimer::JKQTPHighResTimer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>class constructor. </p>

</div>
</div>
<a id="ac1648000a7686774bc6b6b029fdd4428"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1648000a7686774bc6b6b029fdd4428">&#9670;&nbsp;</a></span>~JKQTPHighResTimer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">JKQTPHighResTimer::~JKQTPHighResTimer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>class destructor </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a667f5e7198a11aa861a5d51e8637408e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a667f5e7198a11aa861a5d51e8637408e">&#9670;&nbsp;</a></span>getTime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double JKQTPHighResTimer::getTime </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>get the time since the last call of <a class="el" href="../../df/d13/a03271.html#a75a2f3ac301bde7a14fa9b39471354ba" title="start the timer">start()</a> in microseconds </p>

</div>
</div>
<a id="a75a2f3ac301bde7a14fa9b39471354ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75a2f3ac301bde7a14fa9b39471354ba">&#9670;&nbsp;</a></span>start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void JKQTPHighResTimer::start </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>start the timer </p>

</div>
</div>
<a id="a26a9b2f4fb964fd9e86d51f218a94de0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a26a9b2f4fb964fd9e86d51f218a94de0">&#9670;&nbsp;</a></span>test()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void JKQTPHighResTimer::test </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>mean</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>stddev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long *&#160;</td>
          <td class="paramname"><em>histogram</em> = <code>nullptr</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>histogram_x</em> = <code>nullptr</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>histogram_size</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>test the resolution </p>
<p>mean value and standard deviation of 1000000 timer polls will be evaluated and returned in <code>mean</code> and <code>stddev</code>. If you supply <code>histogram</code> with a pointer to a memory array with <code>histogram_size</code> items this will hold afterwards a histogram of the data. <code>histogram_x</code> wil contain the time interval values of the histogram bins in <code>histogram</code>.</p>
<p>To measure the resolution this method uses this code: </p><div class="fragment"><div class="line"><span class="keywordtype">double</span> l=<a class="code" href="../../df/d13/a03271.html#a667f5e7198a11aa861a5d51e8637408e">getTime</a>(), n;</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i=0; i&lt;runs; i++) {</div><div class="line">  n=<a class="code" href="../../df/d13/a03271.html#a667f5e7198a11aa861a5d51e8637408e">getTime</a>();</div><div class="line">  h[i]=n-l;</div><div class="line">  l=n;</div><div class="line">}</div></div><!-- fragment --> <pre class="fragment"></pre> 
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="abd10df27113d10087fec1b46ef031e81"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd10df27113d10087fec1b46ef031e81">&#9670;&nbsp;</a></span>last</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct timeval JKQTPHighResTimer::last</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="../../d7/d38/a02054_source.html">jkqtphighrestimer.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../df/d13/a03271.html">JKQTPHighResTimer</a></li>
    <li class="footer">Generated on Wed Mar 6 2019 22:39:09 for JKQTPlotter by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
