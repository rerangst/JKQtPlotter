<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JKQTPlotter: Example (JKQTPlotter): Simple line-graph with live-data (speed test)</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../jkqtplotter_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">JKQTPlotter
   </div>
   <div id="projectbrief">an extensive Qt4/Qt5 Plotter framework (including a fast variant and a LaTeX equation renderer!), written fully in C/C++ and without external dependencies</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('da/d9f/a03636.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Example (<a class="el" href="../../db/d65/a03179.html" title="plotter widget for scientific plots (uses JKQTBasePlotter to do the actual drawing)This class is a QW...">JKQTPlotter</a>): Simple line-graph with live-data (speed test) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This project (see <code>./examples/simpletest_speed/</code>) simply creates a <a class="el" href="../../db/d65/a03179.html" title="plotter widget for scientific plots (uses JKQTBasePlotter to do the actual drawing)This class is a QW...">JKQTPlotter</a> widget (as a new window) and adds two line-graph (a sine and a cosine wave). Data is stored in two <a href="https://en.cppreference.com/w/cpp/container/array"><code>std::array&lt;double, NDATA&gt;</code></a> objects (<code>X</code>, <code>Y</code>, and <code>Y2</code>) and the data is added as external pointer to the datastore: </p><div class="fragment"><div class="line"><span class="comment">// 3. make data available to JKQTPlotter by adding it to the internal datastore.</span></div><div class="line"><span class="comment">//    Here the data from the std::array&#39;s is not copied, but only the pointer to</span></div><div class="line"><span class="comment">//    the array is added to the datastore. therefore the datastore does not manage</span></div><div class="line"><span class="comment">//    the memory, oly uses the data stored in it!</span></div><div class="line"><a class="code" href="../../d0/de4/a02851.html">JKQTPDatastore</a>* ds=getDatastore();</div><div class="line"><span class="keywordtype">size_t</span> columnX=ds-&gt;<a class="code" href="../../d0/de4/a02851.html#ae057eda96c7b754cd42f4380b429a589">addColumn</a>(X.data(), X.size(), <span class="stringliteral">&quot;x&quot;</span>);</div><div class="line"><span class="keywordtype">size_t</span> columnY=ds-&gt;<a class="code" href="../../d0/de4/a02851.html#ae057eda96c7b754cd42f4380b429a589">addColumn</a>(Y.data(), Y.size(), <span class="stringliteral">&quot;y&quot;</span>);</div><div class="line"><span class="keywordtype">size_t</span> columnY2=ds-&gt;<a class="code" href="../../d0/de4/a02851.html#ae057eda96c7b754cd42f4380b429a589">addColumn</a>(Y2.data(), Y2.size(), <span class="stringliteral">&quot;y2&quot;</span>);</div></div><!-- fragment --><p> The datastore then uses the data from the <code>std::array</code> instances, but does not own their memory, i.e. also does not free it. This is useful, when data fro external sources should be used without copying.</p>
<p>For this example we also don't use axis autoscaling, but set the axes explicitly: </p><div class="fragment"><div class="line"><span class="comment">// 6. scale the plot so the graph is contained</span></div><div class="line">setX(X[0], X[NDATA-1]);</div><div class="line">setY(-2,2);</div></div><!-- fragment --><p>Finally a slot is started with a one-shot timer. In that slot, the data is shifted one place to the left and the graph is updated. The slot also calculated the current framerate and displays it in the window title. Finally a single-shot timer with 1ms delay is used to call the slot again (i.e. continuously): </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="../../d0/d4b/a03415.html#a5d3de1d65ae2c1eb4578de868b43f33f">SpeedTestPlot::plotNewData</a>()</div><div class="line">{</div><div class="line">    <span class="comment">// move old data to the left</span></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i&lt;NDATA-1; i++) {</div><div class="line">        <a class="code" href="../../d0/d4b/a03415.html#a58acab317fc7a318a6230f40cbeb4d8b">X</a>[i]=<a class="code" href="../../d0/d4b/a03415.html#a58acab317fc7a318a6230f40cbeb4d8b">X</a>[i+1];</div><div class="line">        <a class="code" href="../../d0/d4b/a03415.html#a5305c5be04cb3bd6a0788d786155d14d">Y</a>[i]=<a class="code" href="../../d0/d4b/a03415.html#a5305c5be04cb3bd6a0788d786155d14d">Y</a>[i+1];</div><div class="line">        <a class="code" href="../../d0/d4b/a03415.html#a9ce7ec8f5c77476df07aceb95cc8c83d">Y2</a>[i]=<a class="code" href="../../d0/d4b/a03415.html#a9ce7ec8f5c77476df07aceb95cc8c83d">Y2</a>[i+1];</div><div class="line">    }</div><div class="line">    <span class="comment">// add one new data point</span></div><div class="line">    <a class="code" href="../../d0/d4b/a03415.html#a58acab317fc7a318a6230f40cbeb4d8b">X</a>[NDATA-1]=<a class="code" href="../../d0/d4b/a03415.html#a58acab317fc7a318a6230f40cbeb4d8b">X</a>[NDATA-2]+<a class="code" href="../../d0/d4b/a03415.html#aff532d54531cf5db539e5a825750baa3">dx</a>;</div><div class="line">    <a class="code" href="../../d0/d4b/a03415.html#a5305c5be04cb3bd6a0788d786155d14d">Y</a>[NDATA-1]=sin(<a class="code" href="../../d0/d4b/a03415.html#a58acab317fc7a318a6230f40cbeb4d8b">X</a>[NDATA-1])+static_cast&lt;double&gt;(std::rand())/static_cast&lt;double&gt;(RAND_MAX + 1u)-0.5;</div><div class="line">    <a class="code" href="../../d0/d4b/a03415.html#a9ce7ec8f5c77476df07aceb95cc8c83d">Y2</a>[NDATA-1]=cos(<a class="code" href="../../d0/d4b/a03415.html#a58acab317fc7a318a6230f40cbeb4d8b">X</a>[NDATA-1])+static_cast&lt;double&gt;(std::rand())/static_cast&lt;double&gt;(RAND_MAX + 1u)-0.5;</div><div class="line"></div><div class="line">    <span class="comment">// set new x-range and replot</span></div><div class="line">    <a class="code" href="../../db/d65/a03179.html#a09adcf0afc9e0b2847262c850e18aa5d">setX</a>(<a class="code" href="../../d0/d4b/a03415.html#a58acab317fc7a318a6230f40cbeb4d8b">X</a>[0], <a class="code" href="../../d0/d4b/a03415.html#a58acab317fc7a318a6230f40cbeb4d8b">X</a>[NDATA-1]);</div><div class="line">    <a class="code" href="../../db/d65/a03179.html#aebce042360ddc51b50472760ed272f7d">redrawPlot</a>();</div><div class="line"></div><div class="line">    <span class="comment">// calculate and update FPS-rate in window title</span></div><div class="line">    <span class="keyword">auto</span> tlastalst=<a class="code" href="../../d0/d4b/a03415.html#a39cadaf9f397c66c2103607fd358c91d">t_lastplot</a>;</div><div class="line">    <a class="code" href="../../d0/d4b/a03415.html#a39cadaf9f397c66c2103607fd358c91d">t_lastplot</a>=std::chrono::system_clock::now();</div><div class="line">    <span class="keywordtype">double</span> delta_secs=static_cast&lt;double&gt;(std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(<a class="code" href="../../d0/d4b/a03415.html#a39cadaf9f397c66c2103607fd358c91d">t_lastplot</a>-tlastalst).count())/1000.0;</div><div class="line">    setWindowTitle(QString(<span class="stringliteral">&quot;Live Data Speed Test: %2 datapoint, %1 fps&quot;</span>).arg(1/delta_secs).arg(NDATA));</div><div class="line">    <span class="comment">// enqueue call for next data value</span></div><div class="line">    QTimer::singleShot(1, <span class="keyword">this</span>, SLOT(<a class="code" href="../../d0/d4b/a03415.html#a5d3de1d65ae2c1eb4578de868b43f33f">plotNewData</a>()));</div><div class="line">}</div></div><!-- fragment --><p>The result looks like this:</p>
<img src="https://raw.githubusercontent.com/jkriege2/JKQtPlotter/master/screenshots/jkqtplotter_simpletest_speed.png" alt="jkqtplotter_simpletest_speed1" class="inline"/>
<p>There are different facor affecting the replot speed:</p><ol type="1">
<li><em>Anti-Aliasing:</em> If <code><a class="el" href="../../db/d65/a03179.html" title="plotter widget for scientific plots (uses JKQTBasePlotter to do the actual drawing)This class is a QW...">JKQTPlotter</a></code> uses Anti-Aliasing for plotting, the plots are much nicer, but also about a factor of 3-4 slower. This is due to the increased amount of calculations, necessary in the drawing sub-system of Qt. You can configrue anti-aliasing with these calls: <div class="fragment"><div class="line">plot.<a class="code" href="../../db/d65/a03179.html#ae4f1ab656cfc37b600667853a1b23686">getPlotter</a>()-&gt;<a class="code" href="../../d9/daf/a02807.html#a4706bf608223fd2ffbf71afb5b9e5d4f">setUseAntiAliasingForGraphs</a>(<span class="keyword">false</span>);</div><div class="line">plot.<a class="code" href="../../db/d65/a03179.html#ae4f1ab656cfc37b600667853a1b23686">getPlotter</a>()-&gt;<a class="code" href="../../d9/daf/a02807.html#a1b6db291aaa5416b7c5d38fce8641557">setUseAntiAliasingForSystem</a>(<span class="keyword">false</span>);</div><div class="line">plot.<a class="code" href="../../db/d65/a03179.html#ae4f1ab656cfc37b600667853a1b23686">getPlotter</a>()-&gt;<a class="code" href="../../d9/daf/a02807.html#a9ab1d12d8da8b47f93657ffccaa9cff2">setUseAntiAliasingForText</a>(<span class="keyword">false</span>);</div></div><!-- fragment --></li>
<li><em>Number of Graphs:</em> The number of plots (and also ther type and complexity) is a major imapct factor in the plotting speed. You can switch off a plot with the context menu:<br />
<img src="https://raw.githubusercontent.com/jkriege2/JKQtPlotter/master/screenshots/contextmenu_graph_visibility.png" alt="contextmenu_graph_visibility" class="inline"/>
</li>
<li><em>Axis Scales and Plot Appearance:</em> Replotting is done in two steps: First the plot with the axes, labels etc. is drawn. Then the graphs are draw on top. Therefore a replot is faster, if only the graphs change, because the background (plot) does not have to be replotted.</li>
</ol>
<p>the next table summarizes some results for plotting speed under different conditions, obatined with the test program in this directory (conditions: Qt 5.11, 32-bit, MinGW, Release, Phenom II X4 765, 500 data points):</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Anti-Aliasing  </th><th class="markdownTableHeadNone">X-Axis Redraw  </th><th class="markdownTableHeadNone"># Graphs  </th><th class="markdownTableHeadNone">frame rate [fps]   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">yes  </td><td class="markdownTableBodyNone">yes  </td><td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">4   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">yes  </td><td class="markdownTableBodyNone">yes  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">7   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">yes  </td><td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">9   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">yes  </td><td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">16   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">yes  </td><td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">18   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">yes  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">24   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">32   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">no  </td><td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">48   </td></tr>
</table>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d8/d13/a03609.html">Example &amp; Tutorial Projects</a></li>
    <li class="footer">Generated on Wed Mar 6 2019 22:39:08 for JKQTPlotter by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
